---
- block:
  - name: Add key for Mesosphere repository for Debian systems
    apt_key:
      keyserver: keyserver.ubuntu.com
      id: E56151BF

  - name: Determine Linux distribution distributor
    shell: lsb_release -is | tr '[:upper:]' '[:lower:]'
    register: release_distributor

  - name: Determine Linux distribution codename
    command: lsb_release -cs
    register: release_codename

  - name: Add Mesosphere repository to sources list
    copy:
      content: "deb http://repos.mesosphere.io/{{release_distributor.stdout}} {{release_codename.stdout}} main"
      dest: /etc/apt/sources.list.d/mesosphere.list
      mode: 0644

  - name: Install chronos package in Debian systems
    apt: pkg=chronos state=present update_cache=yes

  when: ansible_distribution_major_version == "14"

# Chronos package doesn't exist in ubuntu 16
# We have to install it manually
- block:
  - name: Create chronos directory
    file:
      path: /opt/chronos
      state: directory

  - name: Copy chronos lib
    copy:
      dest: /opt/chronos/chronos-3.0.3.jar
      src: ub16/chronos-3.0.3.jar
      mode: 0644
      force: no

  - name: Run Chronos
    command: java -cp chronos-3.0.3.jar org.apache.mesos.chronos.scheduler.Main --master zk://localhost:2181/mesos --zk_hosts localhost:2181
    args:
      chdir: /opt/chronos

  when: ansible_distribution_major_version == "16"
